Bank

channel int@{H} ALICE/INSUFFICIENT_FUNDS;

var int[]@{H} balance = [0,0,0,0];

TRANSFER((int*(int*int))@{H} msg : m) {
    var int@{H} from = fst msg;
    var int@{H} to = fst snd msg;
    var int@{H} amount = snd snd msg;

    ;;

    oblif amount <= balance[from]
    then {
        balance[from] ?= balance[from] - amount;
        balance[to] ?= balance[to] - amount;
    } else {
        send(ALICE/INSUFFICIENT_FUNDS,amount);
    }
}